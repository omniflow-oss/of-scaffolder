package {{rootPackage}}.module.{{moduleName}}.{{usecasePackage}}.infrastructure.strategy;

import {{rootPackage}}.module.{{moduleName}}.{{usecasePackage}}.domain.config.{{usecasePascal}}ConfigurationKeys;
import {{rootPackage}}.module.{{moduleName}}.{{usecasePackage}}.domain.port.{{connectorPascal}}ClientPort;
import {{rootPackage}}.shared.infrastructure.strategy.StrategySelectorSupport;
import io.smallrye.mutiny.Uni;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.enterprise.inject.Instance;
import jakarta.inject.Inject;
import org.eclipse.microprofile.config.inject.ConfigProperty;

@ApplicationScoped
public class {{connectorPascal}}ClientSelector implements {{connectorPascal}}ClientPort {

  private final Instance<{{connectorPascal}}ClientPort> candidates;
  private final StrategySelectorSupport selector;
  private final String adapter;

  @Inject
  public {{connectorPascal}}ClientSelector(
      Instance<{{connectorPascal}}ClientPort> candidates,
      StrategySelectorSupport selector,
      @ConfigProperty(name = {{usecasePascal}}ConfigurationKeys.CONNECTOR_{{connectorSafe}}_ADAPTER, defaultValue = "inmemory") String adapter
  ) {
    this.candidates = candidates;
    this.selector = selector;
    this.adapter = adapter;
  }

  @Override
  public Uni<String> call(String request) {
    return selector.select(candidates, {{connectorPascal}}ClientPort.class, adapter).call(request);
  }
}

